<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>éšœå®³é¦¬æŸ±åˆ†æ</title>
    <style>
        :root { --primary: #1b4332; --bg: #f0f2f5; }
        body { font-family: -apple-system, sans-serif; background: var(--bg); margin: 0; padding: 10px; color: #333; font-size: 13px; }
        .container { max-width: 1000px; margin: 0 auto; }
        
        /* å…¥åŠ›ã‚¨ãƒªã‚¢ */
        .card { background: white; padding: 12px; border-radius: 8px; box-shadow: 0 2px 8px rgba(0,0,0,0.1); margin-bottom: 10px; }
        .input-grid { display: grid; grid-template-columns: 1fr 1fr; gap: 6px; }
        label { display: block; font-size: 10px; font-weight: bold; color: #666; margin-bottom: 2px; }
        select, input { width: 100%; padding: 8px; border: 1px solid #ccc; border-radius: 4px; font-size: 14px; box-sizing: border-box; }

        /* ãƒ¬ã‚³ãƒ¼ãƒ‰è¡¨ç¤ºæ¬„ï¼ˆè¡Œã‚’åˆ†ã‘ã‚‹ï¼‰ */
        .record-fixed-area { 
            grid-column: span 2; background: #f8f9fa; border-left: 4px solid var(--primary); 
            padding: 8px; border-radius: 4px; margin: 4px 0; font-size: 12px; line-height: 1.5;
        }
        .rec-course { font-weight: bold; color: var(--primary); border-bottom: 1px solid #eee; margin-bottom: 2px; }
        .rec-detail { font-size: 13px; }

        .slot-selector { display: flex; gap: 4px; grid-column: span 2; margin-top: 5px; }
        .slot-btn { flex: 1; padding: 8px; border: 1px solid #ccc; background: #eee; border-radius: 4px; font-size: 11px; cursor: pointer; }
        .slot-btn.active { background: var(--primary); color: white; border-color: var(--primary); font-weight: bold; }

        /* ãƒ†ãƒ¼ãƒ–ãƒ« */
        .outer-scroll { width: 100%; overflow-x: auto; background: white; border-radius: 8px; box-shadow: 0 2px 5px rgba(0,0,0,0.1); }
        .horse-table { border-collapse: collapse; min-width: 900px; width: 100%; }
        .th-slot { font-size: 14px !important; font-weight: bold !important; background: #f1f3f1; color: #1b4332; padding: 12px 5px !important; border-bottom: 2px solid #ddd; }
        
        .horse-name-cell { 
            position: sticky; left: 0; z-index: 10; background: #333; color: white; width: 110px; min-width: 110px; 
            padding: 10px 8px; text-align: center; border-bottom: 1px solid #444; border-right: 2px solid #222; 
            font-weight: bold; font-size: 14px; /* 14pxã«çµ±ä¸€ */
        }
        .del-horse { font-size: 9px; color: #ff9999; cursor: pointer; text-decoration: underline; display: block; margin-top: 5px; font-weight: normal; }

        .race-td { border-bottom: 1px solid #eee; border-right: 1px solid #ddd; width: 160px; min-width: 160px; padding: 0; vertical-align: top; background: #fafafa; }
        .race-box { padding: 8px 6px; text-align: center; position: relative; min-height: 140px; }
        
        .r-note { font-size: 13px; font-weight: bold; color: #000; height: 32px; display: flex; align-items: center; justify-content: center; line-height: 1.1; margin-bottom: 1px; }
        .r-cond { font-size: 11px; color: #555; background: #e8e8e8; padding: 1px 6px; border-radius: 3px; margin-bottom: 8px; display: inline-block; }
        
        .r-time { font-size: 15px; font-weight: bold; color: #222; margin: 0; }
        .r-rank { font-size: 12px; margin: 2px 0 4px 0; }
        .badge { color: white; padding: 1px 5px; border-radius: 3px; font-size: 10px; }

        .r-ratio { font-size: 14px; font-weight: bold; color: #333; padding: 3px; border-radius: 4px; border: 1px solid #eee; display: block; }
        .best-s { background: #fee2e2; color: #b91c1c; border-color: #fecaca; }
        .best-a { background: #ffedd5; color: #c2410c; border-color: #fed7aa; }
        .best-b { background: #dcfce7; color: #15803d; border-color: #bbf7d0; }
        
        /* ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸€è¦§ï¼ˆã‚¢ã‚³ãƒ¼ãƒ‡ã‚£ã‚ªãƒ³ï¼‰ */
        details { background: white; border-radius: 8px; margin-top: 15px; border: 1px solid #ddd; }
        summary { padding: 12px; font-weight: bold; color: var(--primary); cursor: pointer; text-align: center; list-style: none; }
        .master-rec-list { padding: 10px; font-size: 11px; }
        .v-header { background: #eee; padding: 4px; font-weight: bold; margin-top: 8px; border-left: 3px solid var(--primary); }
    </style>
</head>
<body>

<div class="container">
    <div class="card">
        <div class="input-grid">
            <div style="grid-column: span 2;"><label>é¦¬å</label><input type="text" id="hName" placeholder="é¦¬å"></div>
            <div><label>ç«¶é¦¬å ´</label><select id="venue" onchange="updateCourse()"><option value="">é¸æŠ</option><option value="nakayama">ä¸­å±±</option><option value="tokyo">æ±äº¬</option><option value="kyoto">äº¬éƒ½</option><option value="hanshin">é˜ªç¥</option><option value="niigata">æ–°æ½Ÿ</option><option value="kokura">å°å€‰</option><option value="fukushima">ç¦å³¶</option><option value="chukyo">ä¸­äº¬</option></select></div>
            <div><label>è·é›¢</label><select id="course" onchange="updateRecordDisplay()"></select></div>
            
            <div id="recInfo" class="record-fixed-area">
                <div class="rec-course">å ´æ‰€ã¨è·é›¢ã‚’é¸æŠ</div>
                <div class="rec-detail">-</div>
            </div>

            <div><label>ãƒ¬ãƒ¼ã‚¹å</label><input type="text" id="rNote"></div>
            <div><label>ã‚¿ã‚¤ãƒ (315.2ç­‰)</label><input type="text" id="rTime"></div>
            <div><label>ç€é †</label><input type="number" id="rRank"></div>
            <div><label>é¦¬å ´</label><select id="rTrack"><option value="è‰¯">è‰¯</option><option value="ç¨">ç¨é‡</option><option value="é‡">é‡</option><option value="ä¸">ä¸è‰¯</option></select></div>
            <div class="slot-selector">
                <button class="slot-btn active" onclick="setSlot(0)">1èµ°å‰</button>
                <button class="slot-btn" onclick="setSlot(1)">2èµ°å‰</button>
                <button class="slot-btn" onclick="setSlot(2)">3èµ°å‰</button>
                <button class="slot-btn" onclick="setSlot(3)">4èµ°å‰</button>
                <button class="slot-btn" onclick="setSlot(4)">5èµ°å‰</button>
            </div>
        </div>
        <button class="btn-primary" style="width:100%; padding:12px; border:none; border-radius:4px; font-weight:bold; margin-top:10px; cursor:pointer;" onclick="addEntry()">ç™»éŒ² / ä¸Šæ›¸ã</button>
    </div>

    <div class="outer-scroll">
        <table class="horse-table">
            <thead>
                <tr>
                    <th class="horse-name-cell" style="background:#222;">é¦¬å</th>
                    <th class="th-slot">1èµ°å‰</th>
                    <th class="th-slot">2èµ°å‰</th>
                    <th class="th-slot">3èµ°å‰</th>
                    <th class="th-slot">4èµ°å‰</th>
                    <th class="th-slot">5èµ°å‰</th>
                </tr>
            </thead>
            <tbody id="hTableBody"></tbody>
        </table>
    </div>

    <details>
        <summary>ğŸ“Š å…¨ç«¶é¦¬å ´ãƒ¬ã‚³ãƒ¼ãƒ‰ä¸€è¦§ã‚’è¡¨ç¤º</summary>
        <div id="masterRecordList" class="master-rec-list"></div>
    </details>
    
    <button onclick="if(confirm('å…¨æ¶ˆå»ï¼Ÿ')) {horses={}; localStorage.removeItem('horseV6'); render();}" style="width:100%; margin-top:20px; padding:10px; background:#999; color:white; border:none; border-radius:4px; font-size:11px;">å…¨ãƒ‡ãƒ¼ã‚¿ãƒªã‚»ãƒƒãƒˆ</button>
</div>

<script>
const db = {
    nakayama: { label: "ä¸­å±±", data: [{ name: "èŠ4260m", record: 290.5, horse: "ã‚¨ã‚³ãƒ­ãƒ‡ãƒ¥ã‚¨ãƒ«" }, { name: "èŠ4250m", record: 283.0, horse: "ã‚ªã‚¸ãƒ¥ã‚¦ãƒãƒ§ã‚¦ã‚µãƒ³" }, { name: "èŠ4100m", record: 276.1, horse: "ã‚ªã‚¸ãƒ¥ã‚¦ãƒãƒ§ã‚¦ã‚µãƒ³" }, { name: "èŠ3570m", record: 237.9, horse: "ãƒ­ãƒƒã‚¯ãƒ¦ãƒ¼" }, { name: "ãƒ€3550m", record: 238.1, horse: "ãƒã‚¤ãƒ†ã‚£ãƒ–ãƒœãƒ¼ã‚¤" }, { name: "èŠ3370m", record: 225.4, horse: "ã‚®ãƒ«ãƒ‡ãƒƒãƒ‰ã‚¨ãƒ¼ã‚¸" }, { name: "èŠ3350m", record: 220.8, horse: "ãƒ¡ã‚¸ãƒ­ã‚ªãƒ¼ãƒ¢ãƒ³ãƒ‰" }, { name: "èŠ3210m", record: 209.3, horse: "ã‚¹ãƒã‚¤ãƒ«ã‚¹ãƒ«ãƒ¼" }, { name: "ãƒ€3200m", record: 211.0, horse: "ã‚­ãƒ£ãƒ‹ã‚ªãƒ³ã‚¹ãƒˆãƒ¼ãƒ " }, { name: "èŠ3030m", record: 200.3, horse: "ãƒªãƒ³ãƒ‡ãƒ³ãƒã‚¦ãƒ " }, { name: "ãƒ€2880m", record: 190.2, horse: "ãƒã‚¤ãƒãƒ«ãƒ›ãƒ©ã‚¤ã‚ºãƒ³" }, { name: "èŠ2710m", record: 182.2, horse: "ãƒã‚¤ãƒãƒ«ã‚¿ã‚¹ã‚¯" }, { name: "ãƒ€2700m", record: 176.8, horse: "ãƒ‘ãƒ¯ãƒ¼ã‚¯ãƒªãƒ³ãƒˆ" }] },
    kyoto: { label: "äº¬éƒ½", data: [{ name: "èŠ3930m", record: 261.6, horse: "ã‚¨ãƒ ã‚¨ã‚¹ãƒ¯ãƒ¼ãƒ«ãƒ‰" }, { name: "ãƒ€3790m", record: 255.0, horse: "ã‚¢ãƒ‰ãƒã‚¤ãƒ¤ãƒ›ãƒ¼ãƒ—" }, { name: "ãƒ€3760m", record: 254.4, horse: "ã‚«ãƒãƒˆã‚·ã‚¬ãƒãƒŠãƒ¼" }, { name: "ãƒ€3190m", record: 211.5, horse: "ãƒ•ãƒŸãƒãƒˆã‚­ãƒ¡ã‚­" }, { name: "èŠ3180m", record: 213.5, horse: "ãƒ©ãƒ³ãƒ‰ãƒ‘ãƒ¯ãƒ¼" }, { name: "èŠ3170m", record: 210.4, horse: "ãƒ†ã‚¤ã‚¨ãƒ ãƒãƒªã‚¢ãƒ¼" }, { name: "ãƒ€3170m", record: 208.4, horse: "ãƒªã‚¿ãƒ¼ãƒ³ã‚¨ãƒ¼ã‚¹" }, { name: "ãƒ€2930m", record: 192.2, horse: "ãƒ†ã‚¤ã‚¨ãƒ ãƒãƒªã‚¢ãƒ¼" }, { name: "ãƒ€2910m", record: 191.2, horse: "ã‚µãƒ ã‚½ãƒ³ãƒ“ãƒƒã‚°" }] },
    tokyo: { label: "æ±äº¬", data: [{ name: "èŠ3300m", record: 215.1, horse: "ãƒ¡ãƒ«ã‚·ãƒ¼ã‚¨ã‚¤ã‚¿ã‚¤ãƒ " }, { name: "ãƒ€3300m", record: 216.2, horse: "ã‚®ãƒ«ãƒ†ã‚£ã‚¹ãƒˆãƒ©ã‚¤ã‚¯" }, { name: "ãƒ€3285m", record: 216.2, horse: "ã‚¨ã‚¤ã‚·ãƒ³ãƒœã‚¹ãƒˆãƒ³" }, { name: "èŠ3110m", record: 203.6, horse: "ãƒ­ãƒ¼ãƒ‰ãƒˆã‚¥ãƒ•ã‚§ã‚¤ãƒ " }, { name: "ãƒ€3100m", record: 202.0, horse: "ã‚¢ãƒ‰ãƒã‚¤ãƒ¤ãƒ„ãƒã‚µ" }, { name: "ãƒ€3000m", record: 197.5, horse: "ã‚·ãƒ«ã‚¯ãƒªã‚¹ãƒšã‚¯ãƒˆ" }] },
    hanshin: { label: "é˜ªç¥", data: [{ name: "èŠ3900m", record: 259.1, horse: "ã‚ªã‚¸ãƒ¥ã‚¦ãƒãƒ§ã‚¦ã‚µãƒ³" }, { name: "èŠ3800m", record: 258.1, horse: "ãƒ•ã‚¡ã‚¤ãƒ–ãƒã‚¤ãƒ³ã‚¿ãƒ¼" }, { name: "èŠ3140m", record: 204.8, horse: "ã‚ªãƒ¼ã‚¹ãƒŸãƒ ãƒ¼ãƒ³" }, { name: "ãƒ€3110m", record: 205.0, horse: "ãƒãƒˆãƒ«ãƒ–ãƒ¬ãƒ¼ãƒ´" }, { name: "ãƒ€2970m", record: 195.7, horse: "ãƒ‘ãƒ«ãƒ†ã‚£ã‚¢ã‚·ãƒãƒ¼" }] },
    niigata: { label: "æ–°æ½Ÿ", data: [{ name: "èŠ3290m", record: 214.4, horse: "ãƒ¦ã‚­ãƒã‚¹ãƒ©ã‚¤ãƒ€ãƒ¼" }, { name: "èŠ3250m", record: 208.3, horse: "ã‚µã‚¯ã‚»ãƒƒã‚·ãƒ§ãƒ³" }, { name: "èŠ2890m", record: 185.5, horse: "ã‚¼ãƒãƒ´ã‚¡ãƒ¼ã‚¹" }, { name: "èŠ2850m", record: 181.4, horse: "ãƒ€ã‚¤ãƒ¯ã‚¦ã‚¤ãƒ³ãƒ€ãƒ " }] },
    kokura: { label: "å°å€‰", data: [{ name: "èŠ3390m", record: 220.0, horse: "ãƒ©ãƒ³ãƒ˜ãƒ©ãƒ³ãƒ" }, { name: "èŠ2900m", record: 187.1, horse: "ãƒ­ãƒ³ã‚°ã‚¢ã‚­ãƒ¬ã‚¹" }, { name: "èŠ2860m", record: 186.3, horse: "ãƒªãƒãƒ¼ã‚·ãƒ–ãƒ«ãƒ¬ãƒ¼ãƒ³" }] },
    fukushima: { label: "ç¦å³¶", data: [{ name: "èŠ3380m", record: 218.5, horse: "ãƒ©ãƒƒã‚­ãƒ¼ã‚¹ãƒˆãƒªãƒ¼ã‚¯" }, { name: "èŠ3350m", record: 219.0, horse: "ã‚µãƒ³ãƒ©ã‚¤ã‚ºãƒ­ã‚¤ãƒ¤ãƒ«" }, { name: "èŠ2800m", record: 181.8, horse: "ã‚¨ãƒ¼ã‚·ãƒ³ã‚¸ãƒ¼ãƒ©ã‚¤ãƒ³" }, { name: "èŠ2770m", record: 179.3, horse: "ã‚µãƒŠã‚·ã‚ªãƒ³" }, { name: "èŠ2750m", record: 177.2, horse: "ãƒ´ã‚§ã‚¤ãƒ«ãƒãƒ“ãƒ¥ãƒ©" }] },
    chukyo: { label: "ä¸­äº¬", data: [{ name: "èŠ3900m", record: 254.8, horse: "ãƒãƒ¼ãƒ‹" }, { name: "èŠ3330m", record: 217.4, horse: "ãƒ¦ã‚¦ã‚­ãƒ“ãƒãƒ¯ãƒ³ãƒ€ãƒ¼" }, { name: "èŠ3300m", record: 213.3, horse: "ã‚¿ã‚¬ãƒã‚¨ã‚¹ãƒ—ãƒ¬ãƒƒã‚½" }, { name: "èŠ3000m", record: 195.8, horse: "ãƒ—ãƒªãƒ¢ã‚¹ãƒšãƒ©ãƒ³ãƒ„ã‚¡" }] }
};

let horses = {};
let currentSlot = 0;

window.onload = function() {
    const saved = localStorage.getItem('horseV6');
    if(saved){ horses = JSON.parse(saved); render(); }
    initMasterRecords();
};

function setSlot(n) {
    currentSlot = n;
    document.querySelectorAll('.slot-btn').forEach((b,i) => b.classList.toggle('active', i===n));
}

function updateCourse() {
    const v = document.getElementById('venue').value;
    const c = document.getElementById('course');
    c.innerHTML = '<option value="">è·é›¢ã‚’é¸æŠ</option>';
    if(v && db[v]) db[v].data.forEach((d,i) => {
        const o = document.createElement('option'); o.value = i; o.innerText = d.name; c.appendChild(o);
    });
    updateRecordDisplay();
}

function updateRecordDisplay() {
    const v = document.getElementById('venue').value;
    const i = document.getElementById('course').value;
    const info = document.getElementById('recInfo');
    if(v && i !== ""){
        const d = db[v].data[i];
        info.innerHTML = `<div class="rec-course">ğŸ ${db[v].label} ${d.name}</div><div class="rec-detail">ãƒ¬ã‚³ãƒ¼ãƒ‰: <b>${Math.floor(d.record/60)}:${(d.record%60).toFixed(1).padStart(4,'0')}</b> (${d.horse})</div>`;
    } else {
        info.innerHTML = `<div class="rec-course">å ´æ‰€ã¨è·é›¢ã‚’é¸æŠ</div><div class="rec-detail">-</div>`;
    }
}

function addEntry() {
    const name = document.getElementById('hName').value.trim() || "æœªå…¥åŠ›";
    const vKey = document.getElementById('venue').value;
    const cIdx = document.getElementById('course').value;
    const val = document.getElementById('rTime').value.trim();
    if(!vKey || cIdx === "" || !val) return alert("å…¥åŠ›ä¸è¶³");

    let s = 0;
    if(val.includes(':')){ const p = val.split(':'); s = parseFloat(p[0])*60 + parseFloat(p[1]); }
    else { s = Math.floor(parseFloat(val)/100)*60 + (parseFloat(val)%100); }
    const tStr = `${Math.floor(s/60)}:${(s%60).toFixed(1).padStart(4,'0')}`;
    const ratio = (s / db[vKey].data[cIdx].record) * 100;

    if(!horses[name]) horses[name] = [null, null, null, null, null];
    horses[name][currentSlot] = {
        note: document.getElementById('rNote').value || "-",
        venue: db[vKey].label, dist: db[vKey].data[cIdx].name,
        time: tStr, ratio: ratio.toFixed(2), rank: document.getElementById('rRank').value || "-",
        cond: document.getElementById('rTrack').value
    };
    localStorage.setItem('horseV6', JSON.stringify(horses));
    render();
}

function render() {
    const tbody = document.getElementById('hTableBody');
    tbody.innerHTML = "";
    const cs = {"è‰¯":"#28a745","ç¨":"#8bc34a","é‡":"#ffc107","ä¸":"#f44336"};

    // äº”åéŸ³é †ã«ã‚½ãƒ¼ãƒˆã—ã¦æç”»
    const sortedNames = Object.keys(horses).sort((a, b) => a.localeCompare(b, 'ja'));

    sortedNames.forEach(name => {
        let tds = "";
        horses[name].forEach((h, idx) => {
            if(!h) { tds += `<td class="race-td"><div class="race-box empty">æœªå…¥åŠ›</div></td>`; }
            else {
                const r = parseFloat(h.ratio);
                let rClass = r < 101.5 ? 'best-s' : r < 103.0 ? 'best-a' : r < 104.5 ? 'best-b' : '';
                tds += `
                <td class="race-td">
                    <div class="race-box">
                        <div class="box-ctrl"><span style="cursor:pointer;color:#bbb;" onclick="editSlot('${name}',${idx})">âœ</span></div>
                        <div class="r-note">${h.note}</div>
                        <div class="r-cond">${h.venue}${h.dist}</div>
                        <div class="r-time">${h.time}</div>
                        <div class="r-rank"><span class="badge" style="background:${cs[h.cond]}">${h.cond}</span> <b>${h.rank}ç€</b></div>
                        <div class="r-ratio ${rClass}">${h.ratio}%</div>
                    </div>
                </td>`;
            }
        });
        tbody.innerHTML += `<tr><td class="horse-name-cell">${name}<span class="del-horse" onclick="delHorse('${name}')">å‰Šé™¤</span></td>${tds}</tr>`;
    });
}

function editSlot(name, idx) {
    const h = horses[name][idx];
    document.getElementById('hName').value = name;
    document.getElementById('rNote').value = h.note;
    document.getElementById('rTime').value = h.time;
    document.getElementById('rRank').value = h.rank;
    document.getElementById('rTrack').value = h.cond;
    setSlot(idx);
    window.scrollTo(0,0);
}

function delHorse(n){ if(confirm(n + " ã‚’å‰Šé™¤ã—ã¾ã™ã‹ï¼Ÿ")){ delete horses[n]; localStorage.setItem('horseV6', JSON.stringify(horses)); render(); } }

function initMasterRecords() {
    const list = document.getElementById('masterRecordList');
    let h = "";
    for(const k in db){
        h += `<div class="v-header">${db[k].label}</div><table style="width:100%; border-collapse:collapse;">`;
        db[k].data.forEach(d => {
            h += `<tr style="border-bottom:1px solid #eee;">
                    <td style="padding:4px;">${d.name}</td>
                    <td><b>${Math.floor(d.record/60)}:${(d.record%60).toFixed(1).padStart(4,'0')}</b></td>
                    <td style="color:#666; text-align:right;">${d.horse}</td>
                  </tr>`;
        });
        h += `</table>`;
    }
    list.innerHTML = h;
}
</script>
</body>
</html>
